import{r as i,aF as M,aG as V,j as e,C as o,b as d,d as m,aB as Z,e as p,y as Ne,z as ve,D as A,aY as _,aZ as X,ax as R,a4 as F,F as T,az as g,I as K,B as n,aA as Se,G as Ce,a_ as Q,a$ as W,k as ee,w as se,b0 as we,x as ae,O as be,p as te,q as re,s as ne,t as ie,v as le,m as B,an as q,aC as ce,J as ke,$ as Ae,a6 as Te,aU as Ee,_ as Ie,H as Oe}from"./index-06367dd5.js";import{S as Pe}from"./switch-4ecee9f7.js";import{D as De}from"./download-593282f1.js";import{U as Re}from"./upload-78f6894e.js";function ze(){const[oe,z]=i.useState("api-key"),[h,S]=i.useState(""),[E,de]=i.useState(!1),[l,I]=i.useState(null),[J,L]=i.useState(!1),[C,U]=i.useState("basicprofile"),[y,w]=i.useState({}),[c,O]=i.useState(null),[u,N]=i.useState([]),[b,G]=i.useState(""),[$,Y]=i.useState(!1),v=[{id:"basicprofile",name:"Basic Profile",path:"/propertyapi/v1.0.0/property/basicprofile",description:"Get basic property information including address, lot size, and building details",icon:e.jsx(Te,{className:"w-4 h-4"}),parameters:[{name:"address1",label:"Street Address",type:"text",required:!0,description:"Street address of the property",placeholder:"586 Franklin Ave"},{name:"address2",label:"City, State",type:"text",required:!0,description:"City and state",placeholder:"Brooklyn, NY"},{name:"geoid",label:"Geographic ID",type:"text",required:!1,description:"Optional geographic identifier"}],sampleAddress:"586 Franklin Ave, Brooklyn, NY"},{id:"detail",name:"Property Detail",path:"/propertyapi/v1.0.0/property/detail",description:"Get detailed property information including rooms, features, and history",icon:e.jsx(Ee,{className:"w-4 h-4"}),parameters:[{name:"address1",label:"Street Address",type:"text",required:!0,description:"Street address of the property",placeholder:"586 Franklin Ave"},{name:"address2",label:"City, State",type:"text",required:!0,description:"City and state",placeholder:"Brooklyn, NY"}]},{id:"valuation",name:"Property Valuation",path:"/propertyapi/v1.0.0/property/valuation",description:"Get property valuation and market data",icon:e.jsx(Ie,{className:"w-4 h-4"}),parameters:[{name:"address1",label:"Street Address",type:"text",required:!0,description:"Street address of the property",placeholder:"586 Franklin Ave"},{name:"address2",label:"City, State",type:"text",required:!0,description:"City and state",placeholder:"Brooklyn, NY"}]},{id:"expandedprofile",name:"Expanded Profile",path:"/propertyapi/v1.0.0/property/expandedprofile",description:"Get comprehensive property data including all available information",icon:e.jsx(Oe,{className:"w-4 h-4"}),parameters:[{name:"address1",label:"Street Address",type:"text",required:!0,description:"Street address of the property",placeholder:"586 Franklin Ave"},{name:"address2",label:"City, State",type:"text",required:!0,description:"City and state",placeholder:"Brooklyn, NY"}]}],j=v.find(s=>s.id===C)||v[0];i.useEffect(()=>{const s={};j.parameters.forEach(t=>{s[t.name]=t.defaultValue||""}),w(s)},[C]),i.useEffect(()=>{me(),ue()},[]);const me=async()=>{try{const s=await fetch(`https://${M}.supabase.co/functions/v1/make-server-a24396d5/attom-key-updater/key-info`,{method:"GET",headers:{Authorization:`Bearer ${V}`,"Content-Type":"application/json"}});s.ok&&(await s.json()).hasKey&&S("cca24467d5861c7e58a2bc7c9cc926af")}catch(s){console.error("Error loading current API key:",s)}},pe=async s=>{const t=s||h;if(!t.trim()){I({success:!1,hasKey:!1,keyLength:0,message:"Please enter an API key to test"});return}L(!0);try{const r=await(await fetch(`https://${M}.supabase.co/functions/v1/make-server-a24396d5/attom-key-updater/test-new-key`,{method:"POST",headers:{Authorization:`Bearer ${V}`,"Content-Type":"application/json"},body:JSON.stringify({apiKey:t})})).json();I(r)}catch(a){I({success:!1,hasKey:!1,keyLength:0,message:`Error testing API key: ${a instanceof Error?a.message:"Unknown error"}`})}finally{L(!1)}},xe=async()=>{if(!h.trim()){alert("Please configure your API key first");return}Y(!0),O(null);try{const s=`https://api.gateway.attomdata.com${j.path}`,t=new URL(s);Object.entries(y).forEach(([k,f])=>{f&&f.toString().trim()&&t.searchParams.append(k,f.toString())}),console.log("Testing endpoint:",t.toString());const a=await fetch(t.toString(),{method:"GET",headers:{accept:"application/json",apikey:h,"User-Agent":"Handoff-RealEstate/1.0"}}),r=await a.text();let x;try{x=JSON.parse(r)}catch{x={rawResponse:r,parseError:"Failed to parse as JSON"}}O({success:a.ok,status:a.status,statusText:a.statusText,headers:Object.fromEntries(a.headers.entries()),data:x,url:t.toString(),timestamp:new Date().toISOString()})}catch(s){O({success:!1,error:s instanceof Error?s.message:"Unknown error",timestamp:new Date().toISOString()})}finally{Y(!1)}},P=(s,t)=>{w(a=>({...a,[s]:t}))},he=()=>{if(!b.trim()){alert("Please enter a configuration name");return}const s={id:Date.now().toString(),name:b,endpoint:C,parameters:{...y},createdAt:new Date().toISOString()};N(t=>[s,...t]),G("");try{localStorage.setItem("attom-saved-configurations",JSON.stringify([s,...u]))}catch(t){console.error("Error saving configuration:",t)}},ue=()=>{try{const s=localStorage.getItem("attom-saved-configurations");s&&N(JSON.parse(s))}catch(s){console.error("Error loading saved configurations:",s)}},je=s=>{U(s.endpoint),w(s.parameters),z("endpoint-testing")},ge=s=>{const t=u.filter(a=>a.id!==s);N(t);try{localStorage.setItem("attom-saved-configurations",JSON.stringify(t))}catch(a){console.error("Error saving configurations:",a)}},H=s=>{navigator.clipboard.writeText(s).then(()=>{console.log("Copied to clipboard")}).catch(t=>{console.error("Failed to copy:",t)})},fe=()=>{if(j.sampleAddress){const s=j.sampleAddress.split(", ");if(s.length>=2){const t=s[0],a=s.slice(1).join(", ");w(r=>({...r,address1:t||"",address2:a||""}))}}};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 p-6",children:[e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-6 h-6 text-primary"}),"ATTOM API Configuration Tool"]})}),e.jsx(p,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Comprehensive tool for configuring, testing, and managing ATTOM Data API integrations. Configure your API key, test different endpoints, and save parameter configurations for reuse."})})]}),e.jsxs(Ne,{value:oe,onValueChange:z,children:[e.jsxs(ve,{className:"grid w-full grid-cols-4",children:[e.jsxs(A,{value:"api-key",className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"API Key"]}),e.jsxs(A,{value:"endpoint-testing",className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Endpoint Testing"]}),e.jsxs(A,{value:"saved-configs",className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Saved Configs"]}),e.jsxs(A,{value:"advanced",className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Advanced"]})]}),e.jsx(T,{value:"api-key",className:"space-y-6",children:e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"API Key Configuration"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"api-key",children:"ATTOM API Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(K,{id:"api-key",type:E?"text":"password",value:h,onChange:s=>S(s.target.value),placeholder:"Enter your ATTOM API key...",className:"pr-20"}),e.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex gap-1",children:[e.jsx(n,{type:"button",variant:"ghost",size:"sm",onClick:()=>de(!E),className:"p-1 h-auto",children:E?e.jsx(Se,{className:"w-4 h-4"}):e.jsx(Ce,{className:"w-4 h-4"})}),h&&e.jsx(n,{type:"button",variant:"ghost",size:"sm",onClick:()=>H(h),className:"p-1 h-auto",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),e.jsx(n,{onClick:()=>pe(),disabled:J||!h.trim(),children:J?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Test Key"]})})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(n,{onClick:()=>S("cca24467d5861c7e58a2bc7c9cc926af"),variant:"outline",size:"sm",children:"Use Provided Key"}),e.jsx(n,{onClick:()=>S(""),variant:"outline",size:"sm",children:"Clear"})]}),l&&e.jsxs(se,{className:l.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50",children:[l.success?e.jsx(ee,{className:"w-4 h-4 text-green-600"}):e.jsx(we,{className:"w-4 h-4 text-red-600"}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:l.success?"text-green-800":"text-red-800",children:l.message}),l.testResult&&e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:["Status: ",l.testResult.status," ",l.testResult.statusText]}),l.testResult.hasData!==void 0&&e.jsxs("p",{children:["Has Data: ",l.testResult.hasData?"Yes":"No"]})]}),l.recommendation&&e.jsxs("p",{className:"text-xs font-medium mt-2",children:["ðŸ’¡ ",l.recommendation]})]})})]})]})]})}),e.jsxs(T,{value:"endpoint-testing",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Endpoint Selection"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"ATTOM API Endpoint"}),e.jsxs(te,{value:C,onValueChange:U,children:[e.jsx(re,{children:e.jsx(ne,{})}),e.jsx(ie,{children:v.map(s=>e.jsx(le,{value:s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon,s.name]})},s.id))})]})]}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:j.description}),e.jsx("p",{className:"text-xs font-mono mt-1",children:j.path})]})]})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Parameters",e.jsx(n,{onClick:fe,variant:"outline",size:"sm",className:"ml-auto",children:"Fill Sample"})]})}),e.jsx(p,{className:"space-y-4",children:j.parameters.map(s=>{var t;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:s.name,children:[s.label,s.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.type==="text"||s.type==="number"?e.jsx(K,{id:s.name,type:s.type,value:y[s.name]||"",onChange:a=>P(s.name,a.target.value),placeholder:s.placeholder,required:s.required}):s.type==="select"?e.jsxs(te,{value:y[s.name]||"",onValueChange:a=>P(s.name,a),children:[e.jsx(re,{children:e.jsx(ne,{placeholder:"Select option..."})}),e.jsx(ie,{children:(t=s.options)==null?void 0:t.map(a=>e.jsx(le,{value:a.value,children:a.label},a.value))})]}):s.type==="boolean"?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{checked:y[s.name]||!1,onCheckedChange:a=>P(s.name,a)}),e.jsx(g,{children:s.description})]}):null,e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]},s.name)})})]})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Test Endpoint"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(n,{onClick:xe,disabled:$||!h.trim(),className:"flex-1 max-w-xs",children:$?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Test API Call"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{value:b,onChange:s=>G(s.target.value),placeholder:"Configuration name...",className:"w-48"}),e.jsxs(n,{onClick:he,variant:"outline",disabled:!b.trim(),children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Save"]})]})]}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{variant:c.success?"default":"destructive",children:c.success?"Success":"Error"}),c.status&&e.jsxs(B,{variant:"outline",children:[c.status," ",c.statusText]}),e.jsxs(n,{onClick:()=>H(JSON.stringify(c,null,2)),variant:"outline",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Copy"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm font-medium",children:"Request URL"}),e.jsx(q,{value:c.url||"N/A",readOnly:!0,className:"text-xs font-mono mt-1",rows:3})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm font-medium",children:"Response Headers"}),e.jsx(q,{value:JSON.stringify(c.headers||{},null,2),readOnly:!0,className:"text-xs font-mono mt-1",rows:3})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm font-medium",children:"Response Data"}),e.jsx(q,{value:JSON.stringify(c.data||c.error||{},null,2),readOnly:!0,className:"text-xs font-mono mt-1",rows:15})]})]})]})]})]}),e.jsx(T,{value:"saved-configs",className:"space-y-6",children:e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Saved Configurations",e.jsxs(B,{variant:"outline",className:"ml-auto",children:[u.length," saved"]})]})}),e.jsx(p,{children:u.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No saved configurations yet. Create and save configurations from the Endpoint Testing tab."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(s=>{var t,a;return e.jsxs(o,{className:"hover:shadow-md transition-shadow",children:[e.jsx(d,{className:"pb-2",children:e.jsxs(m,{className:"text-sm flex items-center gap-2",children:[(t=v.find(r=>r.id===s.endpoint))==null?void 0:t.icon,s.name]})}),e.jsxs(p,{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("p",{children:["Endpoint: ",(a=v.find(r=>r.id===s.endpoint))==null?void 0:a.name]}),e.jsxs("p",{children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium mb-1",children:"Parameters:"}),e.jsx("div",{className:"space-y-1",children:Object.entries(s.parameters).map(([r,x])=>x&&e.jsxs("p",{className:"text-muted-foreground",children:[r,": ",x.toString()]},r))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:()=>je(s),variant:"outline",size:"sm",className:"flex-1",children:"Load"}),e.jsx(n,{onClick:()=>ge(s.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(ce,{className:"w-3 h-3"})})]})]})]},s.id)})})})]})}),e.jsx(T,{value:"advanced",className:"space-y-6",children:e.jsxs(o,{children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Advanced Settings"]})}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs(se,{children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsxs(ae,{children:[e.jsx("p",{className:"font-medium",children:"Configuration Management"}),e.jsx("p",{className:"text-sm mt-1",children:"Export your configurations for backup or import from another setup."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{className:"text-base",children:"Export Configurations"})}),e.jsx(p,{children:e.jsxs(n,{onClick:()=>{const s=JSON.stringify(u,null,2),t=new Blob([s],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`attom-configurations-${new Date().toISOString().split("T")[0]}.json`,r.click()},className:"w-full",variant:"outline",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Export All Configurations"]})})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{className:"text-base",children:"Import Configurations"})}),e.jsx(p,{children:e.jsxs(n,{onClick:()=>{const s=document.createElement("input");s.type="file",s.accept=".json",s.onchange=t=>{var r;const a=(r=t.target.files)==null?void 0:r[0];if(a){const x=new FileReader;x.onload=k=>{var f;try{const D=JSON.parse((f=k.target)==null?void 0:f.result);N(ye=>[...D,...ye]),localStorage.setItem("attom-saved-configurations",JSON.stringify([...D,...u]))}catch{alert("Failed to import configurations: Invalid file format")}},x.readAsText(a)}},s.click()},className:"w-full",variant:"outline",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Import Configurations"]})})]})]}),e.jsx(Ae,{}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{className:"text-base text-red-600",children:"Danger Zone"})}),e.jsx(p,{children:e.jsxs(n,{onClick:()=>{confirm("Are you sure you want to clear all saved configurations? This cannot be undone.")&&(N([]),localStorage.removeItem("attom-saved-configurations"))},variant:"outline",className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Clear All Configurations"]})})]})]})]})})]})]})}export{ze as AttomApiConfigurationTool};
